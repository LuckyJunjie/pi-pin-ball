# PI-PinBall 测试计划

**版本:** 1.0  
**项目:** PI-PinBall  
**测试框架:** GdUnit4 + GDSnap  
**日期:** 2026-02-20

---

## 1. 测试目标

验证 PI-PinBall 游戏核心功能的正确性和稳定性。

---

## 2. 测试范围

### 2.1 功能测试

| 模块 | 测试项 | 测试用例ID | 优先级 |
|------|--------|-------------|--------|
| **启动** | 应用启动 | PI-001 | P0 |
| **主菜单** | 菜单显示 | PI-002 | P0 |
| **主菜单** | 开始游戏 | PI-003 | P0 |
| **角色选择** | 角色列表显示 | PI-004 | P1 |
| **角色选择** | 选择角色 | PI-005 | P0 |
| **游戏模式** | 模式选择 | PI-006 | P1 |

### 2.2 游戏核心测试

| 模块 | 测试项 | 测试用例ID | 优先级 |
|------|--------|-------------|--------|
| **发射** | 按Space发射球 | PI-010 | P0 |
| **发射** | 球从发射区射出 | PI-011 | P0 |
| **挡板** | 左挡板响应 | PI-012 | P0 |
| **挡板** | 右挡板响应 | PI-013 | P0 |
| **物理** | 球碰撞反弹 | PI-014 | P0 |
| **物理** | 球重力下落 | PI-015 | P0 |

### 2.3 计分系统测试

| 模块 | 测试项 | 测试用例ID | 优先级 |
|------|--------|-------------|--------|
| **得分** | 碰到得分区域 | PI-020 | P0 |
| **得分** | 分数增加 | PI-021 | P0 |
| **倍率** | 连击倍率触发 | PI-022 | P1 |
| **倍率** | 角色倍率生效 | PI-023 | P1 |
| **球数** | 初始球数 | PI-024 | P0 |
| **球数** | 球掉落减少 | PI-025 | P0 |

### 2.4 UI测试

| 模块 | 测试项 | 测试用例ID | 优先级 |
|------|--------|-------------|--------|
| **分数显示** | 分数更新 | PI-030 | P0 |
| **球数显示** | 球数更新 | PI-031 | P0 |
| **倍率显示** | 倍率更新 | PI-032 | P1 |
| **游戏结束** | Game Over显示 | PI-033 | P1 |

### 2.5 截图基准测试

| 测试用例ID | 场景 | 预期结果 |
|------------|------|----------|
| PI-SHOT-001 | 主菜单 | 正确显示菜单UI |
| PI-SHOT-002 | 角色选择 | 显示角色列表 |
| PI-SHOT-003 | 游戏进行中 | 显示球、挡板、分数 |
| PI-SHOT-004 | 得分时 | 分数变化可见 |
| PI-SHOT-005 | 球掉落 | 球数减少 |

---

## 3. 测试用例详细说明

### PI-010: 按Space发射球

**前置条件:**
- 游戏处于等待状态
- 发射器已装载球

**测试步骤:**
1. 启动游戏进入游戏场景
2. 按下 Space 键
3. 观察发射器

**预期结果:**
- 发射器释放球
- 球开始移动

**截图:** PI-SHOT-003

---

### PI-012/013: 挡板响应测试

**前置条件:**
- 球在挡板附近

**测试步骤:**
1. 按下 A 键
2. 观察左挡板
3. 按下 D 键
4. 观察右挡板

**预期结果:**
- 左挡板向上移动
- 右挡板向上移动

---

### PI-020: 碰到得分区域

**前置条件:**
- 球在运动中

**测试步骤:**
1. 让球碰到得分区域
2. 记录碰撞前后分数

**预期结果:**
- 分数增加
- 显示得分特效(如有)

---

### PI-025: 球掉落测试

**前置条件:**
- 球在运动中

**测试步骤:**
1. 让球掉出底部
2. 观察球数显示

**预期结果:**
- 球数从 N 减少到 N-1
- 如果球数=0，显示Game Over

---

## 4. 自动化测试脚本

```gdscript
# test_pinball_game.gd
extends GdUnitTest

func test_ball_launch() -> void:
    var scene = load("res://scenes/Main.tscn").instantiate()
    add_child(scene)
    await get_tree().process_frame
    
    # 发射球
    Input.action_press("ui_accept")
    await get_tree().create_timer(0.5).timeout
    
    # 验证球已发射
    assert_that(scene.has_node("Ball")).is_true()
    
    # 截图
    GDSnap.take_screenshot("ball_launched")
```

---

## 5. 测试数据

### 5.1 角色数据

| 角色ID | 名称 | 倍率 |
|--------|------|------|
| default | 默认角色 | 1.0x |
| lucky | 幸运角色 | 1.2x |

### 5.2 测试分数

| 场景 | 预期分数 |
|------|----------|
| 碰到小得分区 | +10 |
| 碰到大得分区 | +50 |
| 连击 x2 | 基础分 x2 |

---

## 6. 测试环境

- **引擎:** Godot 4.5.1
- **渲染:** Compatibility (GLES3)
- **分辨率:** 1152 x 648

---

## 7. 验收标准

- [ ] 所有 P0 测试用例通过
- [ ] 截图基准测试通过
- [ ] 无崩溃或严重错误

---

*最后更新: 2026-02-20*
